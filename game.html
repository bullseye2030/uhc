<!doctype HTML>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Cube UHC Stats</title>
    
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/spacelab/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.rawgit.com/zudoo/sortable/master/css/sortable-theme-bootstrap.css" rel="stylesheet">
  </head>
  
  <body>
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="./">Cube UHC Stats</a>
        </div>
      </div>
    </nav>
    <div class="container">
      <h1><span id="name">Loading</span> <small id="season">info</small></h1>
      
      <table class="table sortable-theme-bootstrap" data-sortable>
        <thead>
          <tr>
            <th data-sortable-type="numeric">#</th>
            <th>Player</th>
            <th data-sortable="false">Cause of Death</th>
            <th data-sortable-type="numeric">Kills</th>
          </tr>
        </thead>
        
        <tbody>
        
        </tbody>
      </table>
    </div>
  </body>
  
  <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="https://cdn.rawgit.com/zudoo/sortable/master/js/sortable.min.js"></script>
  <script>
    var gameInfo;
    
    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if(pair[0] == variable){return pair[1];}
      }
      return(false);
    }
    
    function loadGame(id) {
      game = gameInfo[id];
      $("#name").text(game.name);
      $("#season").text("Season " + game.season);
      
      game.participants.forEach(function(p) {
        $("tbody").append("<tr id=\"" + p.position +"\"><td>" + p.position + "</td><td><img class=\"img-thumbnail\" src=\"https://crafatar.com/avatars/" + p.uuid + "?size=20\"> " + p.name + "</td><td>" + p.death + "</td><td>" + p.kills + "</td></tr>")
        if (localStorage.getItem("no_colour_code") != "true") {
          switch (p.deathtype) {
            case "none":
              $("#" + p.position).addClass("success");
              break;
            case "pve":
              $("#" + p.position).addClass("info");
              break;
            case "pvp":
              $("#" + p.position).addClass("warning");
              break;
            case "suicide":
              $("#" + p.position).addClass("danger");
              break;
          }
        }
      });
    }
    
    $(function() {
      $.getJSON("stats.json", function(d) {
        gameInfo = d;
        if (getQueryVariable("gameID")) {
          loadGame(getQueryVariable("gameID"));
        }
      });
    });
  </script>
</html>
